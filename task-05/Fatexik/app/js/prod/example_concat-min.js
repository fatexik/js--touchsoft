var dataBaseClass=function(){var e,t={url:"https://touchsoft-fatexik.firebaseio.com/"};function n(e,n,a,i,o){var c=new XMLHttpRequest;return c.open(e,t.url.concat("users").concat(n).concat(a).concat(i).concat(".json")),c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(o)),c}function a(){}return a.prototype.sendMsg=function(e,t){return new Promise(function(a){n("POST",e,"/messages","",t).onreadystatechange=function(){200===this.status&&4===this.readyState&&a(!0)}})},a.prototype.getMessages=function(e){var t;return new Promise(function(a){n("GET",e,"/messages","").onreadystatechange=function(){200===this.status&&4===this.readyState&&(t=JSON.parse(this.response),t=Object.keys(t).map(function(e){return t[e]}),a(t))}})},a.prototype.setMessageRead=function(e){return new Promise(function(t){n("PUT","/".concat(e),"/unreadMessage","",!1).onreadystatechange=function(){200===this.status&&4===this.readyState&&t(!0)}})},a.prototype.getUserChatConfig=function(e){var t={};return new Promise(function(a){n("GET","/".concat(e),"/chatConfig","").onreadystatechange=function(){200===this.status&&4===this.readyState&&(t=JSON.parse(this.response),a(t))}})},a.prototype.getListUsers=function(){var e,t,a=(new Date).getTime();return new Promise(function(i){n("GET","","","").onreadystatechange=function(){200===this.status&&4===this.readyState&&(e=JSON.parse(this.response),t=Object.keys(e).map(function(t){return{name:"You"!==e[t].chatConfig.userName&&""!==e[t].chatConfig.userName?e[t].chatConfig.userName:"no name",id:t,online:a-e[t].activityTime<12e4,unreadMessage:e[t].unreadMessage}}),i(t))}})},{usersList:(e=new a).getListUsers,sendMsg:e.sendMsg,getUserMessages:e.getMessages,getUserConfig:e.getUserChatConfig,setMessageRead:e.setMessageRead}}(),dashboardUpdateList=function(e){var t,n,a,i,o,c=2e3;function s(){}function d(){var e=document.getElementById("workPlace"),t=document.getElementById("adminChatContent"),n=document.createElement("div");n.className="workContentImg",n.id="workContentImg",e.replaceChild(n,t),clearInterval(i)}function r(){var e=document.getElementById("workPlace"),t=document.createElement("div"),n=document.getElementById("workContentImg");t.className="adminChatContent",t.id="adminChatContent",t.innerHTML='            <div class="adminChat">\n                <div class="close" id="close">X</div>\n                <div class ="chatName">CHAT</div>\n                <textarea class="chatHistory" id="chatHistory"></textarea>\n                <textarea class="messagePlace" id="messagePlace"></textarea>\n                <input type="button" class="sendMessageButton" id="sendMessageButton" value="Send Message">\n            </div>\n            <div class="adminConfigPlace"></div>',e.replaceChild(t,n),document.getElementById("close").addEventListener("click",d)}function l(e){var t=e;return t<10&&(t="0".concat(e)),t}function u(){this.sendMessage=function(){var t,n=document.getElementById("messagePlace"),i=document.getElementById("chatHistory"),o=new Date,c=l(o.getMinutes()),s=l(o.getHours());e.setMessageRead(a),e.getUserConfig(a).then(function(o){t=o.showTime?"\n".concat([s,c].join(":").concat(" ".concat("ADMIN").concat(" ").concat(n.value))):"\n".concat(" ".concat("ADMIN").concat(" ").concat(n.value)),i.value+=t,n.value="",e.sendMsg("/".concat(a),t)})}}function m(e,t){return e.name>t.name?1:e.name<t.name?-1:0}function h(e){var t,n,a,i;for(a=e.length-1;a>0;a--){for(n=0,i=0;i<a;i++)e[i].online||(t=e[i],e[i]=e[i+1],e[i+1]=t,n++);if(0===n)break}return e}function v(e){var t=document.getElementById("usersList"),n=document.getElementById("clientSearch"),a=document.createElement("div"),i=n.value.length;n.value===e.name.substring(0,i)&&(a.className="clientBlock",a.id=e.id,a.innerText=e.name,e.online&&(a.style.backgroundColor="green"),e.unreadMessage&&(a.innerText+="✉"),t.appendChild(a),a.addEventListener("click",p))}function g(){var t,n=document.getElementsByClassName("clientBlock"),a=document.getElementById("clientSort").value,i=n.length;e.usersList().then(function(e){for("online"===a?h(e):e.sort(m),t=0;t<i;t++)n[0].remove();Object.keys(e).forEach(function(t){v(e[t])})})}function f(t,a){var i=document.getElementById("chatHistory"),o=document.getElementById("clientSearch"),c=document.getElementById("sendMessageButton");e.getUserMessages("/".concat(t)).then(function(e){i.value=e.join(" ")}),a&&c.removeEventListener("click",n.sendMessage),n=new u,c.addEventListener("click",n.sendMessage),o.addEventListener("change",g)}function p(){var t=arguments[0],n=!0;a=t.target.id,clearInterval(i),e.setMessageRead(a),document.getElementById("adminChatContent")||(r(),n=!1),f(a,n),i=setInterval(function(){f(a,!0)},c)}return s.prototype.createList=function(){e.usersList().then(function(e){h(e),Object.keys(e).forEach(function(t){v(e[t])}),o=setInterval(g,2e3)})},s.prototype.closeAllConnection=function(){clearInterval(i),clearInterval(o)},s.prototype.createDashboard=function(){var e=document.createElement("div");return e.id="createdElem",e.innerHTML='<div class="rootChatManager"><span><div class="filterUser"><input type="search" id="clientSearch"><select name="sort" class="clientSort" id="clientSort"><option disabled="disabled">Sort By</option><option selected="selected" value="online">Online</option><option value="userName">Имя</option></select><div class="usersList" id="usersList"></div></div><div class="workPlace" id="workPlace"><div class="workContentImg" id="workContentImg"></div></div></span></div>',e},{updateUserList:(t=new s).createList,closeConnection:t.closeAllConnection,createDashboard:t.createDashboard}}(dataBaseClass),chatConfig=function(){var e={chatTitle:"Chat",botName:"Bot",chatUrl:"https://touchsoft-fatexik.firebaseio.com/",chatClass:"../CSS/styles.css",chatPosition:!1,allowMinimize:!1,drag:!1,requireName:!1,showTime:!1,network:"XHR"};function t(){return document.getElementById("generate_code").innerText='<script type="text/javascript" src="../JS/Chat.js"><\/script>\n<script type="text/javascript">setConfig({\n    title: "'+e.chatTitle+'",\n    name: "'+e.botName+'",\n    url: "'+e.chatUrl+'",\n    CSS: "'+e.chatClass+'",\n    positionLeft:'+e.chatPosition+",\n    allowMinimize:"+e.allowMinimize+",\n    drag: "+e.drag+",\n    requireName: "+e.requireName+",\n    showTime: "+e.showTime+',\n    network: "'+e.network+'",\n    userName: "",\n    collapsed: true\n}<\/script>',this}return{setFunctionalConfig:function(){var n=document.getElementById("chatTitle"),a=document.getElementById("botName"),i=document.getElementById("chatUrl"),o=document.getElementById("chatClass"),c=document.getElementById("chatPositionSelect"),s=document.getElementById("allowMinimize"),d=document.getElementById("allowDrag"),r=document.getElementById("requireName"),l=document.getElementById("showTime"),u=document.getElementById("networkRadioXHR"),m=document.getElementById("networkRadioFetch");return u.addEventListener("change",function(){e.network=u.value,t()}),m.addEventListener("change",function(){e.network=m.value,t()}),n.addEventListener("change",function(){e.chatTitle=n.value,t()}),a.addEventListener("change",function(){e.botName=a.value,t()}),i.addEventListener("change",function(){e.chatUrl=i.value,t()}),o.addEventListener("change",function(){e.chatClass=o.value,t()}),c.addEventListener("change",function(){var n=c.value;e.chatPosition="Left"===n,t()}),s.addEventListener("change",function(){e.allowMinimize=s.checked,t()}),d.addEventListener("change",function(){e.drag=d.checked,t()}),r.addEventListener("change",function(){e.requireName=r.checked,t()}),l.addEventListener("change",function(){e.showTime=l.checked,t()}),this},updateConfig:t,createConfig:function(){var e=document.createElement("div");return e.id="createdElem",e.innerHTML='<div><div><div>Chat Title</div><input type="text" id="chatTitle"></div><div><div>Bot Name</div><input type="text" id="botName"></div><div><div>Chat URL</div><input type="text" id="chatUrl" value="https://touchsoftchatproject.firebaseio.com"></div><div><div>CSS class</div><input type="text" id="chatClass"></div><div><div>Position</div><select id="chatPositionSelect"><option>Right</option><option>Left</option></select></div><div><div>Allow to minimize</div><div><input type="checkbox" id="allowMinimize"></div><div>Allow drag</div><div><input type="checkbox" id="allowDrag"></div><div>Require name</div><div><input type="checkbox" id="requireName"></div><div>Show data/time</div><div><input type="checkbox" id="showTime"></div></div><form action=""><div>XHR</div><input type="radio" name="contact" value="XHR" id="networkRadioXHR"><div>fetch</div><input type="radio" name="contact" value="fetch" id="networkRadioFetch"></form></div><container><div id="generate_code"></div></container>',e}}}(),aboutMe=function(){return{createAbout:function(){var e=document.createElement("div");return e.id="createdElem",e.innerHTML="<div><h1>Fatexik</h1><h2>Contact us anytime you need: support@example.com</h2></div>",e}}}();function handlerUrl(e,t){var n,a,i=document.getElementById("workSpace");e.includes("dashboard")&&(a=document.getElementById("createdElem"),n=dashboardUpdateList.createDashboard(),i.replaceChild(n,a),dashboardUpdateList.updateUserList()),e.includes("configFile")&&(a=document.getElementById("createdElem"),n=chatConfig.createConfig(),i.replaceChild(n,a),chatConfig.setFunctionalConfig().updateConfig(),t.includes("dashboard")&&dashboardUpdateList.closeConnection()),e.includes("aboutMe")&&(a=document.getElementById("createdElem"),n=aboutMe.createAbout(),i.replaceChild(n,a),t.includes("dashboard")&&dashboardUpdateList.closeConnection())}window.addEventListener("hashchange",function(e){handlerUrl(e.newURL,e.oldURL)}),window.onload=function(){handlerUrl(window.location.href),document.getElementById("dashboard").addEventListener("click",function(e){var t=e.target.getAttribute("href");e.preventDefault(),window.location.hash=t}),document.getElementById("config").addEventListener("click",function(e){var t=e.target.getAttribute("href");e.preventDefault(),window.location.hash=t}),document.getElementById("aboutMe").addEventListener("click",function(e){var t=e.target.getAttribute("href");e.preventDefault(),window.location.hash=t})};